function replaceSectionsWithDivs(){const e=document.querySelector("article").querySelectorAll("section");let t;for(var o=e.length-1;o>=0;o--)t=document.createElement("div"),t.innerHTML=e[o].innerHTML,e[o].parentNode.replaceChild(t,e[o])}function moveChildrenUpALevel(e){var t=e.parentNode;e.childNodes.forEach(o=>{t.insertBefore(o.cloneNode(!0),e)})}function removeDivsInDivs(e){e=e||document.querySelector("article").querySelectorAll("div");let t=Array.from(e).filter(hasOnlyDivChildren);for(;t.length>0;)moveChildrenUpALevel(t[0]),t[0].remove(),e=document.querySelector("article").querySelectorAll("div"),t=Array.from(e).filter(hasOnlyDivChildren)}function removeDivsWithImg(e){(e=e||document.querySelector("article").querySelectorAll("div")).forEach(e=>{e.childNodes.length>1&&3===e.childNodes[0].nodeType&&"Image"===e.childNodes[0].textContent&&e.removeChild(e.childNodes[0])});const t=function(e){return 1===e.childNodes.length&&1===e.childNodes[0].nodeType&&"IMG"===e.childNodes[0].tagName};let o=Array.from(e).filter(t);for(;o.length>0;)moveChildrenUpALevel(o[0]),o[0].remove(),e=document.querySelector("article").querySelectorAll("div"),o=Array.from(e).filter(t)}function hasOnlyDivChildren(e){const t=getChildrenRemoveBlankTextNodes(e);if(0===t.length)return!1;for(var o=0;o<t.length;o++)if("DIV"!==t[o].tagName)return!1;return!0}function removeArticles(){const e=document.querySelector("article").querySelectorAll("article");for(var t=0;t<e.length;t++){for(var o=e[t],r=o.childNodes,n=o.parentNode,l=0;l<r.length;l++)n.insertBefore(r[l].cloneNode(!0),o);o.remove()}}function removeSoloSurroundingDivs(){const e=document.querySelectorAll("article")[0];let t=getChildrenRemoveBlankTextNodes(e);for(;1===t.length&&"DIV"===t[0].tagName;)t=getChildrenRemoveBlankTextNodes(t[0]);e.childNodes.forEach(t=>{e.removeChild(t)}),t.forEach(t=>{e.appendChild(t)})}function removeDivsWithOrphanFigures(){const e=document.querySelectorAll("figure");Array.prototype.forEach.call(e,(function(e,t){const o=e.parentNode;"DIV"==o.tagName&&1===o.childElementCount&&(o.parentNode.insertBefore(e.cloneNode(!0),o),o.remove())}))}function convertDivsToFigures(){const e=document.querySelectorAll("div");Array.prototype.forEach.call(e,(function(e,t){if(2===e.childNodes.length&&"IMG"===e.childNodes[0].tagName&&("P"===e.childNodes[1].tagName||3===e.childNodes[1].nodeType)){let t=document.createElement("figcaption");t.innerHTML=e.childNodes[1].textContent,e.replaceChild(t,e.childNodes[1]);let o=document.createElement("figure");o.innerHTML=e.innerHTML,e.parentNode.replaceChild(o,e)}}))}function removeEmptyParagraphs(){const e=document.querySelectorAll("p");let t=[];Array.prototype.forEach.call(e,(function(e,o){0===e.innerText.trim().length&&0===e.childElementCount&&t.push(e)}));for(var o=t.length-1;o>=0;o--)t[o].remove()}function removeEmptyDivs(){const e=document.querySelectorAll("div");let t=[];Array.prototype.forEach.call(e,(function(e,o){0===e.innerText.trim().length&&0===e.childElementCount&&t.push(e)}));for(var o=t.length-1;o>=0;o--)t[o].remove()}function markShortParagraphs(){const e=document.querySelectorAll("p");Array.prototype.forEach.call(e,(function(e,t){const o=e.innerText;o.length<200&&e.classList.add("short-para"),o.trim().endsWith(":")&&e.classList.add("ends-with-colon")}))}function markSingleCharParagraphs(){const e=document.querySelectorAll("p");Array.prototype.forEach.call(e,(function(e,t){1===e.innerText.length&&e.classList.add("single-char-para")}))}function markImages(){const e=document.querySelectorAll("img");Array.prototype.forEach.call(e,(function(e,t){e.naturalHeight>e.naturalWidth&&e.classList.add("img-portrait"),(e.naturalHeight<20||e.naturalWidth<.6*document.body.clientWidth)&&e.classList.add("img-small")}));const t=document.querySelectorAll("figure");Array.prototype.forEach.call(t,(function(e,t){e.getElementsByTagName("img").length>0&&e.getElementsByTagName("img")[0].classList.contains("img-small")&&e.classList.add("figure-small")}))}function markShortBlockquotes(){const e=document.querySelectorAll("blockquote");Array.prototype.forEach.call(e,(function(e,t){e.innerText.length<100&&e.classList.add("short-blockquote")}))}function markContentHoldingDivs(){const e=document.querySelectorAll("div");let t,o=0;Array.prototype.forEach.call(e,(function(e){if(t=!1,e.children)for(var r=0;r<e.children.length;r++)if("P"===e.children[r].tagName){t=!0;break}t&&(e.classList.add("content-holder"),o++%2&&e.classList.add("alternating"))}))}var toggleCollapsed=e=>{var t=document.querySelectorAll(".js-feed-title")[0];t.classList.contains("collapsed")?t.classList.remove("collapsed"):t.classList.add("collapsed")};function setFontSize(e){const t=document.getElementsByTagName("html")[0];let o;t.classList.forEach(e=>{"font-size"===e.substring(0,9)&&(o=e)}),t.classList.remove(o),t.classList.add("font-size-"+e),window.setTimeout(()=>{window.ReactNativeWebView.postMessage("resize:"+getHeight())},1e3)}function getHeight(){return Math.ceil(document.querySelector("article").getBoundingClientRect().height)}function toggleDarkMode(e){document.getElementsByTagName("html")[0].classList.toggle("dark-background")}function capitaliseFirstWords(){capitaliseFirstChildP(document.querySelector("article"));const e=document.getElementsByTagName("div");Array.prototype.forEach.call(e,capitaliseFirstChildP)}function capitaliseFirstChildP(e){if(e.children)for(var t=15,o=0;o<e.children.length;o++)if("P"===e.children[o].tagName){var r=e.children[o];console.log(r);for(var n=r.childNodes,l=0;l<n.length&&(3===n[l].nodeType?(n[l].nodeValue=capitaliseText(n[l].nodeValue,t),t-=n[l].nodeValue.length):n[l].innerText.length>0&&(n[l].innerText=capitaliseText(n[l].innerText,t),t-=n[l].innerText.length),!(t<=0));l++);break}}function capitaliseText(e,t){if(e.split(/[,\.;:\?!]/,2)[0].length<t)return(o=e.split(/([,\.;:\?!])/))[0]=o[0].toUpperCase(),o.join("");{var o=e.split(" ");let r=0;return o.map((e,o)=>(r+=e.length,r<t?e.toUpperCase():e)).join(" ")}}function removeSourceTags(){for(var e=document.getElementsByTagName("source"),t=e.length-1;t>=0;t--)e[t].remove()}function removeFiguresWithoutImages(){for(var e=document.getElementsByTagName("figure"),t=e.length-1;t>=0;t--)0===e[t].getElementsByTagName("img").length&&e[t].remove()}function markPullQuotes(){var e=document.getElementsByTagName("blockquote");Array.prototype.forEach.call(e,(function(e){if(e.innerText.startsWith("\u201c")&&e.classList.add("is-quote"),!(e.innerText.length>200)){var t=e.previousElementSibling||e.parentElement.previousElementSibling;if(t&&t.innerText){var o=t.innerText;":"!==o.substring(o.length-1)&&e.classList.add("pullquote")}}}))}function markQuoteBlockquotes(){var e=document.getElementsByTagName("blockquote");Array.prototype.forEach.call(e,(function(e){e.innerText.startsWith("\u201c")&&e.classList.add("is-quote")}))}function createFigCaptions(){var e=document.getElementsByTagName("article")[0],t=e.childNodes,o=[];t.forEach((e,t)=>{0!==t&&3===e.nodeType&&0!==e.nodeValue.trim().length&&o.push(t)}),o.forEach(o=>{var r=t[o],n=t[o-1];if(onlyContentIsImg(n)){var l=document.createElement("figure"),i=document.createElement("figcaption");"P"===n.tagName?l.appendChild(n.children[0]):l.appendChild(n.cloneNode(!0)),l.appendChild(i),i.appendChild(r.cloneNode(!0)),e.replaceChild(l,r),e.replaceChild(document.createTextNode(" "),n)}})}function onlyContentIsImg(e){var t=getChildrenRemoveBlankTextNodes(e);return 1===t.length&&(1===t[0].nodeType&&("IMG"===t[0].tagName||onlyContentIsImg(t[0])))}function getChildrenRemoveBlankTextNodes(e){return Array.from(e.childNodes).filter(e=>3!==e.nodeType||e.nodeValue.trim().length>0)}function removeAllBrs(){var e=document.getElementsByTagName("br");let t=[];for(var o=e.length-1;o>=0;o--)t.push(e[o]);for(o=t.length-1;o>=0;o--)t[o].remove()}function remove1pxImages(){Array.from(document.querySelectorAll("img")).filter(e=>"1"===e.getAttribute("height")).forEach(e=>{e.remove()})}function removeWidows(){const e=document.querySelectorAll("p");Array.prototype.forEach.call(e,(function(e,t){console.log(innerHtml)}))}function fadeIntoView(){console.log("fadeIntoView");var e=Array.from(document.querySelectorAll("figure")).concat(Array.from(document.querySelectorAll("blockquote")));window.addEventListener("scroll",(function(t){console.log("We're scrolling!"),e.forEach((function(e){isInViewport(e)&&e.classList.add("in-viewport")}))}),!1)}function addTapMessageToImages(){addTapMessageToElements("img","image:","src")}function addTapMessageToLinks(){addTapMessageToElements("a","link:","href")}function addTapMessageToElements(e,t,o,r){var n=document.querySelectorAll(e);Array.prototype.forEach.call(n,(function(e,n){e.onclick=function(n){return window.ReactNativeWebView.postMessage(t+e.getAttribute(o)),r&&r(e),n.stopPropagation(),n.preventDefault(),!1}}))}function removeNYTImageText(){removeNodes("figure div span")}function removeNodes(e){const t=document.querySelectorAll(e);for(var o=t.length-1;o>=0;o--)t[o].remove()}function removeSrcSets(){const e=document.querySelectorAll("img");for(var t=e.length-1;t>=0;t--)e[t].srcset=""}function stopAutoplay(){[].slice.call(document.getElementsByTagName("video")).forEach(e=>e.removeAttribute("autoplay"))}function highlightSelection(){const e=highlighter.highlightSelection("highlight")[0],t=e.getText(),o=highlighter.serialize(e);window.ReactNativeWebView.postMessage("highlight:"+t+"++++++"+o)}function deselectHighlight(){document.querySelectorAll(".highlighter").forEach(e=>e.classList.remove("highlighter"))}function deleteSelectedHighlight(){document.querySelectorAll(".highlighter").forEach(e=>e.classList.remove("highlighter")),document.querySelectorAll(".highlight").forEach(e=>e.classList.remove("highlight"))}function addTapMessageToHighlights(){addTapMessageToElements(".highlight","edit-highlight:","data-id",e=>{const t=e.getAttribute("data-id");document.querySelectorAll(`[data-id="${t}"]`).forEach(e=>e.classList.add("highlighter"))})}function postMessage(e){const t=JSON.stringify(e);window.ReactNativeWebView?window.ReactNativeWebView.postMessage(t):window.parent?window.parent.postMessage(t,"*"):window.postMessage(t,"*")}let highlighter;function init(){markImages(),addTapMessageToImages(),removeAllBrs(),stopAutoplay(),rangy.init(),highlighter=rangy.createHighlighter(),highlighter.addClassApplier(rangy.createClassApplier("highlight",{ignoreWhiteSpace:!0,tagNames:["span","a"]})),highlights.forEach(e=>{highlighter.deserialize(e.serialized);const t=document.querySelectorAll(".highlight");for(var o=t.length-1;o>=0;o--){const r=t[o];null===r.getAttribute("data-id")&&r.setAttribute("data-id",e._id)}}),addTapMessageToHighlights();let e=0;window.addEventListener("scrollend",(function(t){postMessage(window.scrollY>e?"scroll-down":"scroll-up"),e=window.scrollY}))}replaceSectionsWithDivs(),removeDivsInDivs(),removeArticles(),removeEmptyParagraphs(),removeEmptyDivs(),removeDivsWithOrphanFigures(),markShortParagraphs(),markSingleCharParagraphs(),markShortBlockquotes(),markContentHoldingDivs(),removeSourceTags(),removeFiguresWithoutImages(),markPullQuotes(),markQuoteBlockquotes(),removeAllBrs(),remove1pxImages(),removeNYTImageText(),removeNodes("time"),removeSoloSurroundingDivs(),createFigCaptions(),removeSrcSets(),removeEmptyDivs(),removeDivsWithImg(),convertDivsToFigures(),window.addEventListener("load",init);