(function(b,a){if(typeof define=="function"&&define.amd){define(["./rangy-core"],b)}else{if(typeof module!="undefined"&&typeof exports=="object"){module.exports=b(require("rangy"))}else{b(a.rangy)}}})(function(a){a.createModule("ClassApplier",["WrappedSelection"],function(k,h){var d=k.dom;var x=d.DomPosition;var G=d.arrayContains;var n=k.util;var c=n.forEach;var H="span";var r=n.isHostMethod(document,"createElementNS");function V(ae,ad){for(var ac in ae){if(ae.hasOwnProperty(ac)){if(ad(ac,ae[ac])===false){return false}}}return true}function b(ac){return ac.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Z(ac,ad){return !!ac&&new RegExp("(?:^|\\s)"+ad+"(?:\\s|$)").test(ac)}function R(ad,ac){if(typeof ad.classList=="object"){return ad.classList.contains(ac)}else{var af=(typeof ad.className=="string");var ae=af?ad.className:ad.getAttribute("class");return Z(ae,ac)}}function A(ad,ac){if(typeof ad.classList=="object"){ad.classList.add(ac)}else{var af=(typeof ad.className=="string");var ae=af?ad.className:ad.getAttribute("class");if(ae){if(!Z(ae,ac)){ae+=" "+ac}}else{ae=ac}if(af){ad.className=ae}else{ad.setAttribute("class",ae)}}}var t=(function(){function ac(ad,af,ae){return(af&&ae)?" ":""}return function(ae,ad){if(typeof ae.classList=="object"){ae.classList.remove(ad)}else{var ag=(typeof ae.className=="string");var af=ag?ae.className:ae.getAttribute("class");af=af.replace(new RegExp("(^|\\s)"+ad+"(\\s|$)"),ac);if(ag){ae.className=af}else{ae.setAttribute("class",af)}}}})();function m(ac){var ad=(typeof ac.className=="string");return ad?ac.className:ac.getAttribute("class")}function D(ac){return ac&&ac.split(/\s+/).sort().join(" ")}function B(ac){return D(m(ac))}function s(ad,ac){return B(ad)==B(ac)}function z(ag,af){var ae=af.split(/\s+/);for(var ad=0,ac=ae.length;ad<ac;++ad){if(!R(ag,b(ae[ad]))){return false}}return true}function T(ad){var ac=ad.parentNode;return(ac&&ac.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(ac.nodeName))}function ab(ae,ah,ag,ak,aj){var ac=ae.node,ad=ae.offset;var ai=ac,af=ad;if(ac==ak&&ad>aj){++af}if(ac==ah&&(ad==ag||ad==ag+1)){ai=ak;af+=aj-ag}if(ac==ah&&ad>ag+1){--af}ae.node=ai;ae.offset=af}function o(ad,ac,ae){if(ad.node==ac&&ad.offset>ae){--ad.offset}}function p(ag,af,ae,ac){if(ae==-1){ae=af.childNodes.length}var ad=ag.parentNode;var ah=d.getNodeIndex(ag);c(ac,function(ai){ab(ai,ad,ah,af,ae)});if(af.childNodes.length==ae){af.appendChild(ag)}else{af.insertBefore(ag,af.childNodes[ae])}}function L(ae,ac){var ad=ae.parentNode;var af=d.getNodeIndex(ae);c(ac,function(ag){o(ag,ad,af)});d.removeNode(ae)}function Q(ag,af,ae,ah,ac){var ai,ad=[];while((ai=ag.firstChild)){p(ai,af,ae++,ac);ad.push(ai)}if(ah){L(ag,ac)}return ad}function N(ad,ac){return Q(ad,ad.parentNode,d.getNodeIndex(ad),true,ac)}function E(ac,ag){var ad=ac.cloneRange();ad.selectNodeContents(ag);var ae=ad.intersection(ac);var af=ae?ae.toString():"";return af!=""}function K(ae){var ad=ae.getNodes([3]);var ag=0,af;while((af=ad[ag])&&!E(ae,af)){++ag}var ac=ad.length-1;while((af=ad[ac])&&!E(ae,af)){--ac}return ad.slice(ag,ac+1)}function X(ai,ag){if(ai.attributes.length!=ag.attributes.length){return false}for(var ah=0,ac=ai.attributes.length,af,ad,ae;ah<ac;++ah){af=ai.attributes[ah];ae=af.name;if(ae!="class"){ad=ag.attributes.getNamedItem(ae);if((af===null)!=(ad===null)){return false}if(af.specified!=ad.specified){return false}if(af.specified&&af.nodeValue!==ad.nodeValue){return false}}}return true}function Y(ag,af){for(var ae=0,ac=ag.attributes.length,ad;ae<ac;++ae){ad=ag.attributes[ae].name;if(!(af&&G(af,ad))&&ag.attributes[ae].specified&&ad!="class"){return true}}return false}var u=d.getComputedStyleProperty;var w=(function(){var ac=document.createElement("div");return typeof ac.isContentEditable=="boolean"?function(ad){return ad&&ad.nodeType==1&&ad.isContentEditable}:function(ad){if(!ad||ad.nodeType!=1||ad.contentEditable=="false"){return false}return ad.contentEditable=="true"||w(ad.parentNode)}})();function g(ad){var ac;return ad&&ad.nodeType==1&&(((ac=ad.parentNode)&&ac.nodeType==9&&ac.designMode=="on")||(w(ad)&&!w(ad.parentNode)))}function f(ac){return(w(ac)||(ac.nodeType!=1&&w(ac.parentNode)))&&!g(ac)}var U=/^inline(-block|-table)?$/i;function j(ac){return ac&&ac.nodeType==1&&!U.test(u(ac,"display"))}var l=/[^\r\n\t\f \u200B]/;function P(ac){if(ac.data.length==0){return true}if(l.test(ac.data)){return false}var ad=u(ac.parentNode,"whiteSpace");switch(ad){case"pre":case"pre-wrap":case"-moz-pre-wrap":return false;case"pre-line":if(/[\r\n]/.test(ac.data)){return false}}return j(ac.previousSibling)||j(ac.nextSibling)}function O(ad){var ac=[],af,ae;for(af=0;ae=ad[af++];){ac.push(new x(ae.startContainer,ae.startOffset),new x(ae.endContainer,ae.endOffset))}return ac}function W(af,ae){for(var ah=0,ag,ai,ad,ac=af.length;ah<ac;++ah){ag=af[ah];ai=ae[ah*2];ad=ae[ah*2+1];ag.setStartAndEnd(ai.node,ai.offset,ad.node,ad.offset)}}function I(ac,ad){if(d.isCharacterDataNode(ac)){if(ad==0){return !!ac.previousSibling}else{if(ad==ac.length){return !!ac.nextSibling}else{return true}}}return ad>0&&ad<ac.childNodes.length}function S(ag,al,ad,aj){var am,ak;var ae=(ad==0);if(d.isAncestorOf(al,ag)){return ag}if(d.isCharacterDataNode(al)){var ah=d.getNodeIndex(al);if(ad==0){ad=ah}else{if(ad==al.length){ad=ah+1}else{throw h.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+ad+" in "+al.data)}}al=al.parentNode}if(I(al,ad)){am=al.cloneNode(false);ak=al.parentNode;if(am.id){am.removeAttribute("id")}var ac,ai=0;while((ac=al.childNodes[ad])){p(ac,am,ai++,aj)}p(am,ak,d.getNodeIndex(al)+1,aj);return(al==ag)?am:S(ag,ak,d.getNodeIndex(am),aj)}else{if(ag!=al){am=al.parentNode;var af=d.getNodeIndex(al);if(!ae){af++}return S(ag,am,af,aj)}}return ag}function aa(ad,ac){return ad.namespaceURI==ac.namespaceURI&&ad.tagName.toLowerCase()==ac.tagName.toLowerCase()&&s(ad,ac)&&X(ad,ac)&&u(ad,"display")=="inline"&&u(ac,"display")=="inline"}function v(ac){var ad=ac?"nextSibling":"previousSibling";return function(ai,af){var ag=ai.parentNode;var ah=ai[ad];if(ah){if(ah&&ah.nodeType==3){return ah}}else{if(af){ah=ag[ad];if(ah&&ah.nodeType==1&&aa(ag,ah)){var ae=ah[ac?"firstChild":"lastChild"];if(ae&&ae.nodeType==3){return ae}}}}return null}}var y=v(false),q=v(true);function C(ad){this.isElementMerge=(ad.nodeType==1);this.textNodes=[];var ac=this.isElementMerge?ad.lastChild:ad;if(ac){this.textNodes[0]=ac}}C.prototype={doMerge:function(ac){var ai=this.textNodes;var ah=ai[0];if(ai.length>1){var af=d.getNodeIndex(ah);var ad=[],ae=0,aj,ag;c(ai,function(al,ak){ag=al.parentNode;if(ak>0){ag.removeChild(al);if(!ag.hasChildNodes()){d.removeNode(ag)}if(ac){c(ac,function(am){if(am.node==al){am.node=ah;am.offset+=ae}if(am.node==ag&&am.offset>af){--am.offset;if(am.offset==af+1&&ak<len-1){am.node=ah;am.offset=ae}}})}}ad[ak]=al.data;ae+=al.data.length});ah.data=ad.join("")}return ah.data},getLength:function(){var ad=this.textNodes.length,ac=0;while(ad--){ac+=this.textNodes[ad].length}return ac},toString:function(){var ac=[];c(this.textNodes,function(ae,ad){ac[ad]="'"+ae.data+"'"});return"[Merge("+ac.join(",")+")]"}};var F=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"];var e={};function J(aj,an,am){var ag,af,ai,ah,al=this;al.cssClass=al.className=aj;var ae=null,ad={};if(typeof an=="object"&&an!==null){if(typeof an.elementTagName!=="undefined"){an.elementTagName=an.elementTagName.toLowerCase()}am=an.tagNames;ae=an.elementProperties;ad=an.elementAttributes;for(af=0;ah=F[af++];){if(an.hasOwnProperty(ah)){al[ah]=an[ah]}}ag=an.normalize}else{ag=an}al.normalize=(typeof ag=="undefined")?true:ag;al.attrExceptions=[];var ac=document.createElement(al.elementTagName);al.elementProperties=al.copyPropertiesToElement(ae,ac,true);V(ad,function(ao,ap){al.attrExceptions.push(ao);ad[ao]=""+ap});al.elementAttributes=ad;al.elementSortedClassName=al.elementProperties.hasOwnProperty("className")?D(al.elementProperties.className+" "+aj):aj;al.applyToAnyTagName=false;var ak=typeof am;if(ak=="string"){if(am=="*"){al.applyToAnyTagName=true}else{al.tagNames=b(am.toLowerCase()).split(/\s*,\s*/)}}else{if(ak=="object"&&typeof am.length=="number"){al.tagNames=[];for(af=0,ai=am.length;af<ai;++af){if(am[af]=="*"){al.applyToAnyTagName=true}else{al.tagNames.push(am[af].toLowerCase())}}}else{al.tagNames=[al.elementTagName]}}}J.prototype={elementTagName:H,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:true,applyToEditableOnly:false,useExistingElements:true,removeEmptyElements:true,onElementCreate:null,copyPropertiesToElement:function(aj,ae,ak){var am,al,ah={},ag,ad,af,ai;for(var ac in aj){if(aj.hasOwnProperty(ac)){ad=aj[ac];af=ae[ac];if(ac=="className"){A(ae,ad);A(ae,this.className);ae[ac]=D(ae[ac]);if(ak){ah[ac]=ad}}else{if(ac=="style"){al=af;if(ak){ah[ac]=ag={}}for(am in aj[ac]){if(aj[ac].hasOwnProperty(am)){al[am]=ad[am];if(ak){ag[am]=al[am]}}}this.attrExceptions.push(ac)}else{ae[ac]=ad;if(ak){ah[ac]=ae[ac];ai=e.hasOwnProperty(ac)?e[ac]:ac;this.attrExceptions.push(ai)}}}}}return ak?ah:""},copyAttributesToElement:function(ac,ae){for(var ad in ac){if(ac.hasOwnProperty(ad)&&!/^class(?:Name)?$/i.test(ad)){ae.setAttribute(ad,ac[ad])}}},appliesToElement:function(ac){return G(this.tagNames,ac.tagName.toLowerCase())},getEmptyElements:function(ac){var ad=this;return ac.getNodes([1],function(ae){return ad.appliesToElement(ae)&&!ae.hasChildNodes()})},hasClass:function(ac){return ac.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(ac))&&R(ac,this.className)},getSelfOrAncestorWithClass:function(ac){while(ac){if(this.hasClass(ac)){return ac}ac=ac.parentNode}return null},isModifiable:function(ac){return !this.applyToEditableOnly||f(ac)},isIgnorableWhiteSpaceNode:function(ac){return this.ignoreWhiteSpace&&ac&&ac.nodeType==3&&P(ac)},postApply:function(ao,al,aj,ah){var ac=ao[0],ad=ao[ao.length-1];var af=[],ap;var ai=ac,ae=ad;var am=0,aq=ad.length;var ag,ak;c(ao,function(ar){ak=y(ar,!ah);if(ak){if(!ap){ap=new C(ak);af.push(ap)}ap.textNodes.push(ar);if(ar===ac){ai=ap.textNodes[0];am=ai.length}if(ar===ad){ae=ap.textNodes[0];aq=ap.getLength()}}else{ap=null}});var an=q(ad,!ah);if(an){if(!ap){ap=new C(ad);af.push(ap)}ap.textNodes.push(an)}if(af.length){for(i=0,len=af.length;i<len;++i){af[i].doMerge(aj)}al.setStartAndEnd(ai,am,ae,aq)}},createContainer:function(ac){var af=d.getDocument(ac);var ae;var ad=r&&!d.isHtmlNamespace(ac)&&(ae=ac.namespaceURI)?af.createElementNS(ac.namespaceURI,this.elementTagName):af.createElement(this.elementTagName);this.copyPropertiesToElement(this.elementProperties,ad,false);this.copyAttributesToElement(this.elementAttributes,ad);A(ad,this.className);if(this.onElementCreate){this.onElementCreate(ad,this)}return ad},elementHasProperties:function(ae,ad){var ac=this;return V(ad,function(af,ag){if(af=="className"){return z(ae,ag)}else{if(typeof ag=="object"){if(!ac.elementHasProperties(ae[af],ag)){return false}}else{if(ae[af]!==ag){return false}}}})},elementHasAttributes:function(ad,ac){return V(ac,function(ae,af){if(ad.getAttribute(ae)!==af){return false}})},applyToTextNode:function(ag,ac){if(T(ag)){var ae=ag.parentNode;if(ae.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(ae)&&this.elementHasProperties(ae,this.elementProperties)&&this.elementHasAttributes(ae,this.elementAttributes)){A(ae,this.className)}else{var af=ag.parentNode;var ad=this.createContainer(af);af.insertBefore(ad,ag);ad.appendChild(ag)}}},isRemovable:function(ac){return ac.tagName.toLowerCase()==this.elementTagName&&B(ac)==this.elementSortedClassName&&this.elementHasProperties(ac,this.elementProperties)&&!Y(ac,this.attrExceptions)&&this.elementHasAttributes(ac,this.elementAttributes)&&this.isModifiable(ac)},isEmptyContainer:function(ac){var ad=ac.childNodes.length;return ac.nodeType==1&&this.isRemovable(ac)&&(ad==0||(ad==1&&this.isEmptyContainer(ac.firstChild)))},removeEmptyContainers:function(ae){var af=this;var ad=ae.getNodes([1],function(ah){return af.isEmptyContainer(ah)});var ag=[ae];var ac=O(ag);c(ad,function(ah){L(ah,ac)});W(ag,ac)},undoToTextNode:function(ag,ae,af,ad){if(!ae.containsNode(af)){var ac=ae.cloneRange();ac.selectNode(af);if(ac.isPointInRange(ae.endContainer,ae.endOffset)){S(af,ae.endContainer,ae.endOffset,ad);ae.setEndAfter(af)}if(ac.isPointInRange(ae.startContainer,ae.startOffset)){af=S(af,ae.startContainer,ae.startOffset,ad)}}if(this.isRemovable(af)){N(af,ad)}else{t(af,this.className)}},splitAncestorWithClass:function(ad,af,ac){var ae=this.getSelfOrAncestorWithClass(ad);if(ae){S(ae,ad,af,ac)}},undoToAncestor:function(ad,ac){if(this.isRemovable(ad)){N(ad,ac)}else{t(ad,this.className)}},applyToRange:function(ae,ai){var af=this;ai=ai||[];var ad=O(ai||[]);ae.splitBoundariesPreservingPositions(ad);if(af.removeEmptyElements){af.removeEmptyContainers(ae)}var ah=K(ae);if(ah.length){c(ah,function(aj){if(!af.isIgnorableWhiteSpaceNode(aj)&&!af.getSelfOrAncestorWithClass(aj)&&af.isModifiable(aj)){af.applyToTextNode(aj,ad)}});var ac=ah[ah.length-1];ae.setStartAndEnd(ah[0],0,ac,ac.length);if(af.normalize){af.postApply(ah,ae,ad,false)}W(ai,ad)}var ag=af.getEmptyElements(ae);c(ag,function(aj){A(aj,af.className)})},applyToRanges:function(ac){var ad=ac.length;while(ad--){this.applyToRange(ac[ad],ac)}return ac},applyToSelection:function(ad){var ac=k.getSelection(ad);ac.setRanges(this.applyToRanges(ac.getAllRanges()))},undoToRange:function(ag,ak){var am=this;ak=ak||[];var ae=O(ak);ag.splitBoundariesPreservingPositions(ae);if(am.removeEmptyElements){am.removeEmptyContainers(ag,ae)}var ai=K(ag);var ac,ad;var aj=ai[ai.length-1];if(ai.length){am.splitAncestorWithClass(ag.endContainer,ag.endOffset,ae);am.splitAncestorWithClass(ag.startContainer,ag.startOffset,ae);for(var af=0,ah=ai.length;af<ah;++af){ac=ai[af];ad=am.getSelfOrAncestorWithClass(ac);if(ad&&am.isModifiable(ac)){am.undoToAncestor(ad,ae)}}ag.setStartAndEnd(ai[0],0,aj,aj.length);if(am.normalize){am.postApply(ai,ag,ae,true)}W(ak,ae)}var al=am.getEmptyElements(ag);c(al,function(an){t(an,am.className)})},undoToRanges:function(ac){var ad=ac.length;while(ad--){this.undoToRange(ac[ad],ac)}return ac},undoToSelection:function(ae){var ad=k.getSelection(ae);var ac=k.getSelection(ae).getAllRanges();this.undoToRanges(ac);ad.setRanges(ac)},isAppliedToRange:function(ac){if(ac.collapsed||ac.toString()==""){return !!this.getSelfOrAncestorWithClass(ac.commonAncestorContainer)}else{var ae=ac.getNodes([3]);if(ae.length){for(var ad=0,af;af=ae[ad++];){if(!this.isIgnorableWhiteSpaceNode(af)&&E(ac,af)&&this.isModifiable(af)&&!this.getSelfOrAncestorWithClass(af)){return false}}}return true}},isAppliedToRanges:function(ac){var ad=ac.length;if(ad==0){return false}while(ad--){if(!this.isAppliedToRange(ac[ad])){return false}}return true},isAppliedToSelection:function(ad){var ac=k.getSelection(ad);return this.isAppliedToRanges(ac.getAllRanges())},toggleRange:function(ac){if(this.isAppliedToRange(ac)){this.undoToRange(ac)}else{this.applyToRange(ac)}},toggleSelection:function(ac){if(this.isAppliedToSelection(ac)){this.undoToSelection(ac)}else{this.applyToSelection(ac)}},getElementsWithClassIntersectingRange:function(ac){var ae=[];var ad=this;ac.getNodes([3],function(ag){var af=ad.getSelfOrAncestorWithClass(ag);if(af&&!G(ae,af)){ae.push(af)}});return ae},detach:function(){}};function M(ae,ad,ac){return new J(ae,ad,ac)}J.util={hasClass:R,addClass:A,removeClass:t,getClass:m,hasSameClasses:s,hasAllClasses:z,replaceWithOwnChildren:N,elementsHaveSameNonClassAttributes:X,elementHasNonClassAttributes:Y,splitNodeAt:S,isEditableElement:w,isEditingHost:g,isEditable:f};k.CssClassApplier=k.ClassApplier=J;k.createClassApplier=M;n.createAliasForDeprecatedMethod(k,"createCssClassApplier","createClassApplier",h)});return a},this);